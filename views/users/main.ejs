<%- include("../partials/header.ejs") %>

<h2 class="centered">Welcome <%=user.first_name%></h2>
 
<div class="centered">
<% if (message) { %>
    <p><%= message %></p>
  <% } %>
</div>

<div class="centered">
<h4>Current streak: <%= currentStreak %></h4>
<h4>Longest streak: <%= longestStreak %></h4>
</div>

<!-- CALENDAR -->

<% let entries = {} %>
<% for(let entry of allEntries) {
  let entryDate = new Date(entry.createdAt).toLocaleDateString()
  entries[entryDate] = true
} %>

<div class="calendar">
  <div class="calendar-header">
    <div class="calendar-month">
      <%= new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) %>
    </div>
    <div class="calendar-weekdays">
      <div class="calendar-weekday">Sun</div>
      <div class="calendar-weekday">Mon</div>
      <div class="calendar-weekday">Tue</div>
      <div class="calendar-weekday">Wed</div>
      <div class="calendar-weekday">Thu</div>
      <div class="calendar-weekday">Fri</div>
      <div class="calendar-weekday">Sat</div>
    </div>
  </div>
  <div class="calendar-body">
    <% let daysInMonth = new Date(year, month + 1, 0).getDate(); %>
    <% let firstDayOfMonth = new Date(year, month, 1).getDay(); %>
    <% let lastDayOfMonth = new Date(year, month, daysInMonth).getDay(); %>
    <% let numRows = Math.ceil((firstDayOfMonth + daysInMonth) / 7); %>
    <% let currentDate = 1; %>
    <% for(let i=0; i<numRows; i++) { %>
      <div class="calendar-row">
        <% for(let j=0; j<7; j++) { %>
          <% let isWeekend = (j === 0 || j === 6); %>
          <% let highlightClass = entries[new Date(year, month, currentDate).toLocaleDateString()] ? 'highlight' : ''; %>
          <div class="calendar-date <%= highlightClass %> <%= isWeekend ? 'weekend' : '' %>">
            <% if(i === 0 && j < firstDayOfMonth || currentDate > daysInMonth) { %>
              &nbsp;
            <% } else { %>
              <%= currentDate %>
              <% currentDate++; %>
            <% } %>
          </div>
        <% } %>
      </div>
    <% } %>
  </div>
</div>



<%- include("../partials/footer.ejs") %>
